from unittest import TestCase

import numpy as np

import sbr.preprocessing.gtex

class_names_expected = ['Colon','Heart','Blood','Vagina','Thyroid','Liver','Salivary_Gland',
                        'Pancreas','Cervix_Uteri','Prostate','Ovary','Skin','Pituitary',
                        'Small_Intestine','Fallopian_Tube','Adrenal_Gland','Nerve',
                        'Adipose_Tissue','Spleen','Stomach','Muscle','Blood_Vessel','Lung',
                        'Esophagus','Brain','Testis','Uterus','Kidney','Bladder','Breast']
y_train_0_expected = [0.] * 30
y_train_0_expected[16] = 1.
y_train_0_expected = np.array(y_train_0_expected, dtype=float)

class TestLoad(TestCase):
    def test_data_loads(self):

        import tensorflow as tf
        import tensorflow_datasets as tfds
        from sbr.datasets.structured import gtex
        import numpy as np
        ds, info = tfds.load("gtex", split="train", with_info = True,as_supervised =True)
        l=list(iter(ds.take(info.splits['train'].num_examples)))
        X, y = map(np.array, zip(*l))
        self.assertTrue(y[0] == 11)

    def test_dataset_setup(self):
        [class_names,
         x_train, y_train, 
         x_validation, y_validation, 
         x_test,y_test] = sbr.preprocessing.gtex.dataset_setup(sample_count_threshold=500, 
                                                               test_fraction = 0.1, 
                                                               validation_fraction = 0.1, 
                                                               verbose = True, 
                                                               batch_size = 32, 
                                                               seed = 42)
        self.assertTrue((class_names == class_names_expected).all())
        '''
        print(f'y_train[0]: {y_train[0]}')
        print(f'y_train_0_expected: {y_train_0_expected}')
        print(f'equal: {(y_train[0] == y_train_0_expected).all()}')

        self.assertTrue((y_train[0] == y_train_0_expected).all())
        '''
        #print(x_train[0])
        #print(y_train[0])
        
'''
>>> class_names
array(['Colon', 'Heart', 'Blood', 'Vagina', 'Thyroid', 'Liver',
       'Salivary_Gland', 'Pancreas', 'Cervix_Uteri', 'Prostate', 'Ovary',
       'Skin', 'Pituitary', 'Small_Intestine', 'Fallopian_Tube',
       'Adrenal_Gland', 'Nerve', 'Adipose_Tissue', 'Spleen', 'Stomach',
       'Muscle', 'Blood_Vessel', 'Lung', 'Esophagus', 'Brain', 'Testis',
       'Uterus', 'Kidney', 'Bladder', 'Breast'], dtype='<U15')
>>> x[0]
array([0.42161646, 0.29251293, 0.57556185, 0.43534557, 0.06886963,
       0.64483048, 0.43949671, 0.0116183 , 0.39947728, 0.04894335,
       0.62958544, 0.37165873, 0.55733533, 0.02073067, 0.15074678,
       0.03879009, 0.26017626, 0.44168812, 0.54253919, 0.07334916,
       0.44916998, 0.59220818, 0.44188307, 0.07660055, 0.34644509,
       0.44839048, 0.03849527, 0.49544843, 0.62459661, 0.34700325,
       0.26898133, 0.44056071, 0.05923947, 0.4831683 , 0.45683648,
       0.4448631 , 0.41370915, 0.59461208, 0.43101177, 0.71452813,
       0.        , 0.48873868, 0.31288685, 0.4881221 , 0.4898659 ,
       0.33706346, 0.37896587, 0.37286494, 0.08389282, 0.46277115,
       0.42689687, 0.39549758, 0.39578907, 0.64099058, 0.41598969,
       0.13941949, 0.00741911, 0.2875729 , 0.21963612, 0.39201592,
       0.01156646, 0.        , 0.63123245, 0.28915115, 0.12396719,
       0.39261605, 0.06051885, 0.02515344, 0.0050795 , 0.37286494,
       0.51221678, 0.38888995, 0.36038925, 0.37237505, 0.51514613,
       0.4343619 , 0.        , 0.4364486 , 0.26582734, 0.40991182,
       0.00876269, 0.09286129, 0.30351832, 0.27761811, 0.0348378 ,
       0.33742721, 0.37845909, 0.27649108, 0.26181445, 0.07847912,
       0.42747805, 0.41768585, 0.12192522, 0.10737064, 0.12326446,
       0.37858599, 0.        , 0.        , 0.39869941, 0.12093041,
       0.20037497, 0.44335873, 0.43119899, 0.        , 0.1121285 ])
>>> y[0]
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 1.,
       0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.], dtype=float32)
>>> x_val[0]
array([0.33279533, 0.26460047, 0.49731056, 0.17228922, 0.47933365,
       0.64898706, 0.31152943, 0.00128998, 0.35312858, 0.40878015,
       0.51923716, 0.32395523, 0.40796494, 0.04399466, 0.02508894,
       0.01557108, 0.48542236, 0.34338319, 0.26240969, 0.03577365,
       0.3866263 , 0.46244598, 0.38741192, 0.32483676, 0.2759751 ,
       0.33398654, 0.00292958, 0.38150794, 0.61494439, 0.45591381,
       0.36419022, 0.42860433, 0.29367108, 0.40250276, 0.08548249,
       0.4432866 , 0.32717699, 0.46464311, 0.31901736, 0.33688116,
       0.00200794, 0.39310137, 0.25485564, 0.50658159, 0.48416622,
       0.27720956, 0.3100021 , 0.31076831, 0.2759751 , 0.31965517,
       0.36288871, 0.42208037, 0.22355733, 0.34211194, 0.32497178,
       0.01091025, 0.00861701, 0.22593372, 0.14599639, 0.33627137,
       0.03272749, 0.        , 0.49452898, 0.03669361, 0.04030943,
       0.3055342 , 0.00624549, 0.01643901, 0.17236581, 0.27168642,
       0.57318415, 0.32313544, 0.24506171, 0.3102325 , 0.53894003,
       0.35333953, 0.        , 0.39586183, 0.17373585, 0.2690143 ,
       0.00798539, 0.12775708, 0.2060312 , 0.12283289, 0.02376334,
       0.27167569, 0.29016094, 0.21636143, 0.37688228, 0.11875172,
       0.4143919 , 0.22425758, 0.05049735, 0.34070886, 0.02093154,
       0.2433701 , 0.        , 0.00966029, 0.32829667, 0.31584703,
       0.32007843, 0.25351746, 0.32244779, 0.00843173, 0.08526454])
>>> y_val[0]
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0.], dtype=float32)
>>> x_test[0]
array([0.39328748, 0.17772606, 0.53260492, 0.28309294, 0.03609229,
       0.54797626, 0.31459827, 0.01899435, 0.30529415, 0.22707994,
       0.59416114, 0.13575594, 0.39182773, 0.15516006, 0.12243913,
       0.02143694, 0.13805073, 0.42722933, 0.38043131, 0.20540145,
       0.24484484, 0.50797209, 0.22002423, 0.3532341 , 0.27792357,
       0.37361795, 0.06791555, 0.51624632, 0.55857439, 0.3808466 ,
       0.18439714, 0.40848734, 0.01915947, 0.54444672, 0.33645465,
       0.45336504, 0.34464052, 0.52341476, 0.45116325, 0.39129915,
       0.34805632, 0.43250107, 0.27524882, 0.52146061, 0.52006524,
       0.4052161 , 0.29161401, 0.38772467, 0.04337553, 0.42471203,
       0.39947728, 0.30899831, 0.05288003, 0.4011911 , 0.39908901,
       0.02922544, 0.01046719, 0.27893595, 0.0851554 , 0.44273208,
       0.00342716, 0.        , 0.53904445, 0.26644714, 0.09301433,
       0.41867375, 0.47421503, 0.32510665, 0.00184213, 0.23864253,
       0.45715661, 0.41534711, 0.38591461, 0.30648938, 0.46750216,
       0.29733483, 0.        , 0.38387383, 0.0665304 , 0.32182535,
       0.        , 0.06303559, 0.19245001, 0.09473462, 0.02333364,
       0.19417231, 0.34418491, 0.29664594, 0.12239968, 0.06863658,
       0.36303405, 0.3363325 , 0.11182603, 0.03605879, 0.06915871,
       0.28841115, 0.        , 0.44880382, 0.2188049 , 0.06755969,
       0.24615341, 0.33336113, 0.27659399, 0.        , 0.01436306])
>>> y_test[0]
array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.,
       0., 0., 0., 0., 0., 0., 1., 0., 0., 0., 0., 0., 0.], dtype=float32)
>>> x.shape, y.shape, x_val.shape, y_val.shape, x_test.shape, y_test.shape
((12000, 105), (12000, 30), (1472, 105), (1472, 30), (1472, 105), (1472, 30))
'''
